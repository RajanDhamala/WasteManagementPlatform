import{$ as J,r as m,A as Y,u as H,a0 as K,a as W,O as N,j as e,Y as X,D as L,I as P,aG as b,ap as Z,aj as ee,H as se,U as ae,b as h}from"./index-3_z3CT1Q.js";import{T as te,V as u}from"./index-E8LsVO-y.js";import{M as _}from"./message-square-Cedag80l.js";const p=({className:n})=>e.jsx("div",{className:`${n} animate-pulse bg-gray-200 rounded-lg`}),r=({className:n})=>e.jsx("div",{className:`${n} animate-pulse bg-gray-200 rounded h-4`}),ce=()=>{var I;let{title:n}=J();const[j,f]=m.useState(""),[le,M]=m.useState(""),[d,w]=m.useState(null),[x,y]=m.useState({}),[F,v]=m.useState({}),[k,A]=m.useState(),g=Y(s=>s.CurrentUser),o=H(),U=K(),z=()=>{U(`/events/${n}`)},$=async()=>{const s=await h.get(`http://localhost:8000/report/final/${n}`,{withCredentials:!0});return A(s.data.data.Eventdetails.EventId),s.data.data},B=async s=>(await h.put(`http://localhost:8000/community/likeUnlikeDiscussion/${s}`,{},{withCredentials:!0})).data,{data:a,isLoading:i,isError:Q}=W({queryKey:["EventReport",n],queryFn:$}),R=N({mutationFn:async({discussionId:s,comment:t})=>(await h.post("http://localhost:8000/community/commentOnDiscussion",{discussionId:s,comment:t},{withCredentials:!0})).data,onSuccess:()=>{u.success("Reply posted successfully!"),y({}),v({}),o.invalidateQueries(["EventReport",n])},onError:s=>{var t,l;u.error(((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to post reply")}}),C=N({mutationFn:async({content:s,eventId:t})=>(await h.post("http://localhost:8000/community/postTopic",{content:s,eventId:k==="all"?null:t},{withCredentials:!0})).data,onSuccess:()=>{u.success("Discussion posted successfully!"),M(""),o.invalidateQueries(["EventReport",n])},onError:s=>{var t,l;u.error(((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to post discussion")}}),T=N({mutationFn:B,onMutate:async s=>{const t=o.getQueryData(["EventReport",n]);return o.setQueryData(["EventReport",n],l=>({...l,communityPosts:l.communityPosts.map(c=>c._id===s?{...c,hasLiked:!c.hasLiked,likesCount:c.likesCount+(c.hasLiked?-1:1)}:c)})),{prevData:t}},onError:(s,t,l)=>{o.setQueryData(["EventReport",n],l.prevData)},onSuccess:()=>{}}),V=s=>{s.preventDefault(),C.mutate({content:j,eventId:k}),f("")},q=(s,t)=>{s.preventDefault(),R.mutate({discussionId:t,comment:x[t]})},G=s=>{v(t=>({...t,[s]:!t[s]}))},O=s=>{T.mutate(s)},S=s=>{w(s)},D=()=>{w(null)},E={hostedBy:"Green City Initiative",participants:[{id:1,name:"John Smith",role:"Volunteer"},{id:2,name:"Sarah Johnson",role:"Organizer"},{id:3,name:"Mike Peterson",role:"Volunteer"},{id:4,name:"Lisa Chen",role:"Sponsor"}]};return Q?e.jsx("div",{className:"text-center text-red-600",children:"Error loading event report"}):e.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-6",children:[e.jsx("header",{className:"bg-white rounded-xl shadow-md p-6 mb-6",children:i?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"h-8 w-3/4 mb-2"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx(r,{className:"h-4 w-32"}),e.jsx(r,{className:"h-4 w-32"}),e.jsx(r,{className:"h-4 w-32"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:a==null?void 0:a.heading.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:E.hostedBy})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:a==null?void 0:a.heading.date})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:a==null?void 0:a.heading.location})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("section",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 pb-2 border-b flex items-center",children:[e.jsx(b,{className:"h-5 w-5 mr-2 text-blue-500"}),"Before & After"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:i?Array(2).fill().map((s,t)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"w-full h-64"}),e.jsx(r,{className:"h-4 w-1/2 mx-auto"})]},t)):Object.entries((a==null?void 0:a.BeforeAfter)||{}).map(([s,t],l)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"overflow-hidden rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300",children:e.jsx("img",{src:t,alt:s,className:"w-full h-64 object-cover cursor-pointer transform hover:scale-105 transition-transform duration-300",onClick:()=>S({ImageUrl:t,caption:s}),loading:"lazy"})}),e.jsx("p",{className:"text-center text-gray-600 font-medium",children:s})]},l))})]}),e.jsxs("section",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 pb-2 border-b flex items-center",children:[e.jsx(Z,{className:"h-5 w-5 mr-2 text-blue-500"}),"Community Discussion"]}),e.jsx("div",{className:"space-y-6",children:i?Array(2).fill().map((s,t)=>e.jsx("div",{className:"border-l-4 border-blue-100 pl-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(r,{className:"h-4 w-24"}),e.jsx(r,{className:"h-4 w-32"})]}),e.jsx(r,{className:"mt-1 h-4 w-full"}),e.jsx(r,{className:"mt-1 h-4 w-3/4"})]})]})},t)):(I=a==null?void 0:a.communityPosts)==null?void 0:I.map(s=>{var t;return e.jsx("div",{className:"border-l-4 border-blue-100 pl-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("img",{src:s.postedBy.ProfileImage,alt:s.postedBy.name,className:"w-10 h-10 rounded-full",loading:"lazy"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium",children:s.postedBy.name}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(s.date).toLocaleString()})]}),e.jsx("p",{className:"mt-1 text-gray-700",children:s.topic}),e.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>O(s._id),className:`flex items-center text-sm ${s.hasLiked?"text-blue-600":"text-gray-500 hover:text-blue-600"}`,children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),s.likesCount," Likes"]}),e.jsxs("button",{onClick:()=>G(s._id),className:"flex items-center text-gray-500 hover:text-blue-600 text-sm",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Reply"]})]}),F[s._id]&&e.jsxs("form",{onSubmit:l=>q(l,s._id),className:"mt-4 ml-6",children:[e.jsx("textarea",{className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-blue-500 outline-none",rows:"2",placeholder:"Write your reply...",value:x[s._id]||"",onChange:l=>y({...x,[s._id]:l.target.value})}),e.jsx("button",{type:"submit",className:"mt-2 bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 transition-colors",disabled:!((t=x[s._id])!=null&&t.trim()),children:"Post Reply"})]}),s.comments.length>0&&e.jsx("div",{className:"ml-6 mt-4 space-y-4",children:s.comments.map(l=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("img",{src:l.commenter.profileImage,alt:l.commenter.name,className:"w-8 h-8 rounded-full",loading:"lazy"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium",children:l.commenter.name}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(l.commentDate).toLocaleString()})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-700",children:l.comment})]})]},l.commentID))})]})]})},s._id)})}),e.jsx("form",{onSubmit:V,className:"mt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[i?e.jsx(p,{className:"w-10 h-10 rounded-full"}):e.jsx("img",{src:(g==null?void 0:g.ProfileImage)||"",alt:"Your avatar",className:"w-10 h-10 rounded-full",loading:"lazy"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("textarea",{className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-blue-500 outline-none transition-all",rows:"3",placeholder:"Share your thoughts about this event...",value:j,onChange:s=>f(s.target.value)}),e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",disabled:!j.trim()||C.isLoading,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Post Discussion"]})})]})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 pb-2 border-b flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2 text-blue-500"}),"Event Details"]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{className:"h-4 w-24"}),e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-3/4"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(se,{className:"h-4 w-4 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Date & Time"}),e.jsx("p",{className:"text-gray-600",children:a==null?void 0:a.Eventdetails.date}),e.jsxs("p",{className:"text-gray-600",children:[a==null?void 0:a.Eventdetails.StartTime,"-",a==null?void 0:a.Eventdetails.EndingTime]})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(P,{className:"h-4 w-4 text-gray-500 mr-3 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Location"}),e.jsx("p",{className:"text-gray-600",children:a==null?void 0:a.Eventdetails.Location})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Register for Next Event"})})]})]}),e.jsxs("section",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 pb-2 border-b flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 mr-2 text-blue-500"}),"Participants"]}),e.jsxs("div",{className:"space-y-3",children:[E.participants.map(s=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-sm bg-blue-100 text-blue-800 py-1 px-2 rounded-full",children:s.role})]},s.id)),e.jsx("div",{className:"pt-2 text-center text-gray-600",children:"+42 other participants"})]})]}),e.jsxs("section",{className:"bg-white rounded-xl shadow-md p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 pb-2 border-b flex items-center",children:[e.jsx(_,{className:"h-5 w-5 mr-2 text-blue-500"}),"Reviews & Feedback"]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-3/4"})]}):e.jsxs("div",{className:"space-y-4",children:[a==null?void 0:a.ReviewsAndFeedback.map(s=>e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-medium",children:s.Reviewer}),e.jsx("div",{className:"flex",children:[...Array(5)].map((t,l)=>e.jsx("span",{className:`text-lg ${l<s.Rating?"text-yellow-500":"text-gray-300"}`,children:"★"},l))})]}),e.jsx("p",{className:"text-gray-700 text-sm",children:s.Review})]},s.ReviewID)),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"w-full border border-blue-600 text-blue-600 py-2 rounded-lg hover:bg-blue-50 transition-colors",onClick:()=>z(),children:"Leave a Review"})})]})]})]})]}),e.jsxs("section",{className:"bg-white rounded-xl shadow-md p-6 mt-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 pb-2 border-b flex items-center",children:[e.jsx(b,{className:"h-5 w-5 mr-2 text-blue-500"}),"Event Gallery"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:i?Array(6).fill().map((s,t)=>e.jsx(p,{className:"w-full h-40"},t)):a==null?void 0:a.ImageGallary.map(s=>e.jsxs("div",{className:"group relative overflow-hidden rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300",children:[e.jsx("img",{src:s.ImageUrl,alt:s.caption,className:"w-full h-40 object-cover cursor-pointer transform group-hover:scale-105 transition-transform duration-300",onClick:()=>S(s),loading:"lazy"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white p-2 transform translate-y-full group-hover:translate-y-0 transition-transform duration-200",children:e.jsx("p",{className:"text-sm truncate",children:s.caption})})]},Math.random()))}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors inline-flex items-center",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"View All Photos (24)"]})})]})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:D,children:e.jsx("div",{className:"max-w-4xl w-full",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:d.ImageUrl,alt:d.caption,className:"w-full max-h-screen object-contain",loading:"lazy"}),e.jsx("button",{onClick:D,className:"absolute top-4 right-4 bg-black bg-opacity-50 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-opacity-70",children:"✕"})]}),e.jsx("div",{className:"p-4",children:e.jsx("p",{className:"text-lg font-medium",children:d.caption})})]})})})]})};export{ce as default};
