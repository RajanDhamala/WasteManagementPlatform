import{E as Z,j as e,ak as xs,r as c,A as gs,u as us,a as Ee,O as g,U as ps,al as js,am as bs,an as _e,ao as Se,D as I,B as o,a1 as Le,C as N,I as $e,T as Ns,ap as Fe,aq as J,ar as W,as as X,Z as Ie,X as fs,aj as Y,b as m}from"./index-3_z3CT1Q.js";import{C as f,b as ys,c as vs,a as y}from"./card-BYccDaG5.js";import{D as ws,a as Cs,E as ks,b as Ds,c as Te,T}from"./textarea-CAQntgK7.js";import{T as Es,c as i}from"./index-E8LsVO-y.js";import{L as _s}from"./leaf-CCg0J-Ud.js";import{M as Me}from"./message-square-Cedag80l.js";import{S as Ss}from"./share-2-CtywzFKk.js";import"./Combination-BLwArv2_.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],$s=Z("ChevronDown",Ls);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Is=Z("ChevronUp",Fs);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Ms=Z("SquarePen",Ts),Pe=({onEdit:ee=()=>{},onDelete:se=()=>{},showDetails:n=!0})=>e.jsxs(ws,{children:[e.jsx(Cs,{className:"h-8 w-8 flex items-center justify-center rounded-full hover:bg-green-100 transition-colors",children:e.jsx(ks,{className:"h-5 w-5 text-green-700"})}),e.jsx(Ds,{align:"end",className:"w-36 bg-white border border-green-200 shadow-lg rounded-md p-1",children:n&&e.jsxs(e.Fragment,{children:[e.jsxs(Te,{onClick:ee,className:"flex items-center gap-2 cursor-pointer text-green-700 hover:bg-green-50 rounded-sm py-1.5 px-2",children:[e.jsx(Ms,{className:"h-4 w-4"}),"Edit"]}),e.jsxs(Te,{onClick:se,className:"flex items-center gap-2 cursor-pointer text-red-600 hover:bg-red-50 rounded-sm py-1.5 px-2",children:[e.jsx(xs,{className:"h-4 w-4"}),"Delete"]})]})})]}),Os=()=>{var he,xe,ge,ue,pe,je,be,Ne,fe,ye,ve,we;const[ee,se]=c.useState("discussions"),[n,M]=c.useState("all"),[P,te]=c.useState(""),[ae,B]=c.useState(!1),[z,ze]=c.useState({}),[R,re]=c.useState({}),[q,ne]=c.useState({}),[Ae,ie]=c.useState({}),[le,Be]=c.useState({}),[Re,U]=c.useState(null),[qe,G]=c.useState(null),[j,b]=c.useState(""),d=gs(s=>s.CurrentUser),Q=us(),Ue=async()=>(await m.get("http://localhost:8000/community/GetAllEvents",{withCredentials:!0})).data,Ge=async()=>(await m.get(`http://localhost:8000/community/getPost/${n}`,{withCredentials:!0})).data.data,{data:u,isLoading:Qe,isError:Oe,error:O,refetch:p}=Ee({queryKey:["GetDiscussionPost",n],queryFn:Ge}),{data:l=[],isLoading:He,isError:Ve,error:H}=Ee({queryKey:["GetAllEvents"],queryFn:Ue}),V=g({mutationFn:async s=>{var a,r;const t=await m.put(`http://localhost:8000/community/likeUnlikeDiscussion/${s}`,{},{withCredentials:!0});return{hasLiked:((a=t.data.data)==null?void 0:a.hasLiked)||!1,likesCount:((r=t.data.data)==null?void 0:r.likesCount)||0}},onMutate:async s=>{const t=Q.getQueryData(["GetDiscussionPost",n]);return Q.setQueryData(["GetDiscussionPost",n],a=>a.map(r=>r._id===s?{...r,hasLiked:!r.hasLiked,likesCount:r.likesCount+(r.hasLiked?-1:1)}:r)),{prevData:t}},onError:(s,t,a)=>{Q.setQueryData(["GetDiscussionPost",n],a.prevData)}}),v=g({mutationFn:async({content:s,eventId:t})=>(await m.post("http://localhost:8000/community/postTopic",{content:s,eventId:t==="all"?null:t},{withCredentials:!0})).data,onSuccess:()=>{i.success("Discussion posted successfully!"),te(""),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to post discussion")}}),Ke=g({mutationFn:async({id:s,content:t})=>(console.log(s),(await m.put(`http://localhost:8000/community/editPost/${s}`,{content:t},{withCredentials:!0})).data),onSuccess:()=>{i.success("Discussion updated successfully!"),U(null),b(""),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update discussion")}}),Je=g({mutationFn:async s=>(await m.delete(`http://localhost:8000/community/deletePost/${s}`,{withCredentials:!0})).data,onSuccess:()=>{i.success("Discussion deleted successfully!"),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete discussion")}}),oe=g({mutationFn:async({comment:s,discussionId:t})=>(await m.post("http://localhost:8000/community/commentOnDiscussion",{comment:s,discussionId:t},{withCredentials:!0})).data,onSuccess:()=>{i.success("Comment posted successfully!"),re({}),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to post comment")}}),We=g({mutationFn:async({discussionId:s,commentId:t,comment:a})=>(await m.put(`http://localhost:8000/community/editComment/${s}/${t}`,{comment:a},{withCredentials:!0})).data,onSuccess:()=>{i.success("Comment updated successfully!"),G(null),b(""),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update comment")}}),Xe=g({mutationFn:async({discussionId:s,commentId:t})=>{const a=await m.delete(`http://localhost:8000/community/deleteComment/${s}/${t}`,{withCredentials:!0});return console.log(a.data),a.data},onSuccess:()=>{i.success("Comment deleted successfully!"),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete comment")}}),Ye=g({mutationFn:async({discussionId:s,content:t,parentCommentId:a})=>(await m.post("http://localhost:8000/community/postReply",{discussionId:s,content:t,parentCommentId:a},{withCredentials:!0})).data,onSuccess:()=>{i.success("Reply posted successfully!"),ne({}),ie({}),p()},onError:s=>{var t,a;i.error(((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to post reply")}}),Ze=()=>{if(!P.trim()){i.error("Discussion cannot be empty");return}v.mutate({content:P,eventId:n})},es=(s,t)=>{U(s),b(t)},ss=s=>{if(!j.trim()){i.error("Content cannot be empty");return}Ke.mutate({id:s,content:j})},ts=s=>{window.confirm("Are you sure you want to delete this discussion?")&&Je.mutate(s)},as=s=>{var a;const t=(a=R[s])==null?void 0:a.trim();if(!t){i.error("Comment cannot be empty");return}oe.mutate({comment:t,discussionId:s})},rs=(s,t,a)=>{G(t),b(a)},ns=(s,t)=>{if(!j.trim()){i.error("Comment cannot be empty");return}We.mutate({discussionId:s,commentId:t,comment:j})},is=(s,t)=>{window.confirm("Are you sure you want to delete this comment?")&&Xe.mutate({discussionId:s,commentId:t})},ls=(s,t=null)=>{var r,h;const a=(h=(r=q[s])==null?void 0:r[t||"root"])==null?void 0:h.trim();if(!a){i.error("Reply cannot be empty");return}Ye.mutate({discussionId:s,content:a,parentCommentId:t})},os=s=>{V.mutate(s)},cs=(s,t="root")=>{ie(a=>({...a,[`${s}-${t}`]:!a[`${s}-${t}`]}))},ds=s=>{Be(t=>({...t,[s]:!t[s]}))},ce=n==="all"?u||[]:(u||[]).filter(s=>s.EventId===n),ms={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.4}}},hs={backgroundImage:"radial-gradient(rgba(74, 222, 128, 0.05) 2px, transparent 2px)",backgroundSize:"30px 30px"},de=s=>{if(!s||typeof s!="string")return"Invalid Date";const t=new Date(s);return isNaN(t.getTime())?"Invalid Date":new Intl.DateTimeFormat("en-US",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)};c.useEffect(()=>{if((u==null?void 0:u.length)>0){const s={};u.forEach(t=>{s[t._id]={hasLiked:t.hasLiked||!1,likesCount:t.likesCount||0}}),ze(s)}},[u]);const me=(s,t=[],a=0)=>t.map(r=>{var h,w,C,k,D,E,_,S,L,$,F,x,A,Ce,ke;return e.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex items-start gap-3 ${a>0?"ml-10 mt-3 border-l-2 border-green-200 pl-4":"mt-4"} ${a===0?"bg-green-50":"bg-green-100"} rounded-lg p-3 shadow-sm border border-green-100`,children:[e.jsxs(J,{className:"w-8 h-8 border border-green-200",children:[e.jsx(W,{src:((h=r.commenter)==null?void 0:h.profileImage)||((w=r.repliedBy)==null?void 0:w.profileImage),alt:((C=r.commenter)==null?void 0:C.name)||((k=r.repliedBy)==null?void 0:k.name)}),e.jsx(X,{className:"text-xs bg-green-100 text-green-800",children:((S=(_=((D=r.commenter)==null?void 0:D.name)||((E=r.repliedBy)==null?void 0:E.name))==null?void 0:_.charAt(0))==null?void 0:S.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:((L=r.commenter)==null?void 0:L.name)||(($=r.repliedBy)==null?void 0:$.name)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-green-600 opacity-70",children:de(r.commentDate||r.replyDate)}),"              ",d&&((F=r.commenter)==null?void 0:F.name)===(d==null?void 0:d.name)&&e.jsx(Pe,{onEdit:()=>rs(s,r.commentID,r.comment),onDelete:()=>is(s,r.commentID)})]})]}),qe===r.commentID?e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(T,{value:j,onChange:K=>b(K.target.value),className:"resize-none border-green-200 focus:ring-green-500 focus:border-green-500 text-sm"}),e.jsx(o,{onClick:()=>ns(s,r.commentID),className:"bg-green-600 hover:bg-green-700 text-white",children:"Save"}),e.jsx(o,{onClick:()=>G(null),variant:"outline",className:"text-green-700 border-green-200 hover:bg-green-50",children:"Cancel"})]}):e.jsx("p",{className:"text-sm text-green-900 mt-1",children:r.comment||r.reply}),!r.replyID&&e.jsx("div",{className:"mt-2",children:e.jsxs(o,{variant:"ghost",size:"sm",className:"text-green-700 hover:bg-green-100",onClick:()=>cs(s,r.commentID),children:[e.jsx(Me,{className:"w-4 h-4 mr-1"}),"Reply"]})}),Ae[`${s}-${r.commentID}`]&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(T,{placeholder:"Type your reply...",className:"resize-none border-green-200 focus:ring-green-500 focus:border-green-500 text-sm",value:((x=q[s])==null?void 0:x[r.commentID])||"",onChange:K=>ne(De=>({...De,[s]:{...De[s],[r.commentID]:K.target.value}}))}),e.jsx(o,{onClick:()=>ls(s,r.commentID),disabled:!((Ce=(A=q[s])==null?void 0:A[r.commentID])!=null&&Ce.trim()),className:"bg-green-600 hover:bg-green-700 text-white",children:e.jsx(Y,{className:"w-4 h-4"})})]}),((ke=r.replies)==null?void 0:ke.length)>0&&e.jsx("div",{className:"mt-3 space-y-3",children:me(s,r.replies,a+1)})]})]},r.commentID||r.replyID)});return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-green-50 to-white py-8 md:ml-[53px]",style:hs,children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(_s,{className:"h-6 w-6 text-green-600 mr-2"}),e.jsx("h1",{className:"text-3xl font-bold text-green-800",children:"EcoClean Community"})]}),e.jsx("p",{className:"text-green-700 opacity-80",children:"Connect, share, and make a difference together"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"lg:w-1/4",children:e.jsxs(f,{className:"sticky top-4 border-green-200 bg-white/80 backdrop-blur-sm shadow-md",children:[e.jsx(ys,{className:"pb-2 border-b border-green-100",children:e.jsxs(vs,{className:"text-xl text-green-800 flex items-center",children:[e.jsx(ps,{className:"h-5 w-5 mr-2 text-green-600"}),"Community Hub"]})}),e.jsx(y,{children:e.jsxs(js,{defaultValue:"events",className:"w-full",children:[e.jsxs(bs,{className:"grid grid-cols-2 mb-4 bg-green-100",children:[e.jsx(_e,{value:"events",className:"data-[state=active]:bg-green-600 data-[state=active]:text-white",children:"Events"}),e.jsx(_e,{value:"topics",className:"data-[state=active]:bg-green-600 data-[state=active]:text-white",children:"Topics"})]}),e.jsx(Se,{value:"events",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-medium text-green-700 flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-2 text-green-600"}),"Upcoming Events"]}),e.jsx(o,{variant:"ghost",size:"sm",className:"text-green-700 hover:text-green-900 hover:bg-green-100",children:"View All"})]}),e.jsx(o,{variant:n==="all"?"default":"outline",className:`w-full justify-start ${n==="all"?"bg-green-600 hover:bg-green-700":"hover:bg-green-50 text-green-800 border-green-200"}`,onClick:()=>M("all"),children:"All Discussions"}),"                      ",He?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(s=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-16 bg-green-50 rounded-lg border border-green-100"})},s))}):Ve?e.jsxs("div",{className:"p-4 rounded-lg bg-red-50 border border-red-200 text-red-600 flex items-center",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),(H==null?void 0:H.message)||"Failed to load events"]}):(xe=(he=l==null?void 0:l.data)==null?void 0:he.events)==null?void 0:xe.map(s=>e.jsx(N.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{duration:.2},children:e.jsx(o,{variant:n===s._id?"default":"outline",className:`w-full justify-start mb-[4px] group transition-all duration-200 py-5 ${n===s._id?"bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white shadow-lg shadow-green-100":"hover:bg-green-50/80 text-green-800 border-green-200 hover:border-green-300 hover:shadow-md"}`,onClick:()=>M(s._id),children:e.jsxs("div",{className:"flex items-center text-left w-full",children:[e.jsx("div",{className:`rounded-xl p-2.5 mr-3 flex items-center justify-center transition-all duration-200 ${n===s._id?"bg-green-500/20 backdrop-blur-sm":"bg-green-100 group-hover:bg-green-200/80"}`,children:e.jsx(I,{className:`h-5 w-5 transition-colors ${n===s._id?"text-white":"text-green-700 group-hover:text-green-800"}`})}),e.jsxs("div",{className:"flex-1 ",children:[e.jsx("div",{className:"font-medium text-[13px] leading-tight mb-1",children:s.title}),e.jsxs("div",{className:`text-xs flex items-center ${n===s._id?"text-white/90":"text-green-600"}`,children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"truncate",children:s.location})]})]}),e.jsx(Ns,{className:`h-4 w-4 ml-2 transition-transform ${n===s._id?"text-white transform translate-x-1":"text-green-400 group-hover:text-green-600 opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0"}`})]})})},s._id))]})}),"                  ",e.jsx(Se,{value:"topics",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Fe,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Topics Coming Soon"}),e.jsx("p",{className:"text-sm text-green-600 opacity-80",children:"We're working on bringing you organized discussion topics. Stay tuned!"})]})})]})})]})}),e.jsxs("div",{className:"lg:w-3/4",children:[e.jsxs(f,{className:"mb-6 border-green-200 shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-500 h-2"}),e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs(J,{className:"border-2 border-green-200",children:[e.jsx(W,{src:(d==null?void 0:d.ProfileImage)||""}),e.jsx(X,{className:"bg-green-100 text-green-800",children:"YP"})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx(T,{placeholder:"Share your thoughts or ask a question about sustainable practices...",className:"resize-none border-green-200 focus:ring-green-500 focus:border-green-500",value:P,onChange:s=>te(s.target.value),disabled:v.isLoading}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[n!=="all"&&e.jsxs(Ie,{className:"bg-green-100 text-green-700 hover:bg-green-200",children:[((pe=(ue=(ge=l==null?void 0:l.data)==null?void 0:ge.events)==null?void 0:ue.find(s=>s._id===n))==null?void 0:pe.title)||"General",e.jsx("button",{className:"ml-1 text-xs",onClick:()=>M("all"),children:"Ã—"})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>B(!ae),className:"text-sm text-green-700 border-green-200 hover:bg-green-50",disabled:v.isLoading,children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Select Event"]}),"                        ",ae&&e.jsx(N.div,{className:"fixed inset-0 bg-black/20 backdrop-blur-[2px] z-40 flex items-start justify-center pt-32",variants:ms,initial:"hidden",animate:"visible",children:e.jsxs(N.div,{className:"bg-white/95 backdrop-blur-sm shadow-xl rounded-xl border border-green-100 p-3 z-50 w-[500px] max-h-[400px] relative",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.2},children:["                              ",e.jsx("button",{onClick:()=>B(!1),className:"absolute right-2 top-2 p-1 hover:bg-green-50 rounded-full text-green-600 transition-colors",children:e.jsx(fs,{className:"h-4 w-4"})}),e.jsxs("div",{className:"space-y-1.5 overflow-y-auto max-h-[300px] p-1",children:[(be=(je=l==null?void 0:l.data)==null?void 0:je.events)==null?void 0:be.map(s=>e.jsx("button",{className:`w-full flex items-center p-2.5 text-sm rounded-lg transition-all ${n===s._id?"bg-green-50 text-green-800 ring-1 ring-green-200":"text-green-700 hover:bg-green-50/80"}`,onClick:()=>{M(s._id),B(!1)},children:e.jsxs("div",{className:"flex items-center w-full",children:[e.jsx("div",{className:`p-2 rounded-lg mr-3 ${n===s._id?"bg-green-200":"bg-green-100"}`,children:e.jsx(I,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium line-clamp-1",children:s.title}),e.jsxs("div",{className:"text-xs text-green-600/80 flex items-center mt-0.5",children:[e.jsx($e,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"line-clamp-1",children:s.location})]})]})]})},s._id)),"                                ",((fe=(Ne=l==null?void 0:l.data)==null?void 0:Ne.events)==null?void 0:fe.length)===0&&e.jsxs("div",{className:"text-center py-8 text-green-600",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-2 text-green-300"}),e.jsx("p",{children:"No events available"})]})]})]})})]}),e.jsx(o,{onClick:Ze,disabled:!P.trim()||v.isLoading,className:"bg-green-600 hover:bg-green-700 text-white",children:v.isLoading?"Posting...":e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Post"]})})]})]})]})})]}),"              ",e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:n==="all"?"Community Discussions":`Discussions: ${((we=(ve=(ye=l==null?void 0:l.data)==null?void 0:ye.events)==null?void 0:ve.find(s=>s._id===n))==null?void 0:we.title)||""}`}),e.jsx("p",{className:"text-sm text-green-600",children:n==="all"?"Join the conversation and share your thoughts with the community":"Share your experiences and connect with event participants"})]})}),e.jsx("div",{className:"space-y-6 mb-8",children:Qe?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx(f,{className:"border-green-200 animate-pulse",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-4 bg-green-100 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-green-100 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-green-100 rounded w-1/2"})]})]})})},s))}):Oe?e.jsx(f,{className:"border-red-200 bg-red-50",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"text-red-600 flex items-center gap-2",children:[e.jsx(Le,{size:20}),e.jsx("span",{children:(O==null?void 0:O.message)||"Failed to load discussions"})]})})}):ce.length>0?ce.map(s=>{var t,a,r,h,w,C,k,D,E,_,S,L,$,F;return e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},children:e.jsx(f,{className:"border-green-200 hover:shadow-md transition-shadow",children:e.jsx(y,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsxs(J,{className:"border-2 border-green-200",children:[e.jsx(W,{src:(t=s.postedBy)==null?void 0:t.ProfileImage,alt:(a=s.postedBy)==null?void 0:a.name}),e.jsx(X,{className:"bg-green-100 text-green-800",children:((w=(h=(r=s.postedBy)==null?void 0:r.name)==null?void 0:h.charAt(0))==null?void 0:w.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:(C=s.postedBy)==null?void 0:C.name}),e.jsx("p",{className:"text-sm text-green-600 opacity-70",children:de(s.date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.EventId&&e.jsx(Ie,{className:"bg-green-100 text-green-700",children:((E=(D=(k=l==null?void 0:l.data)==null?void 0:k.events)==null?void 0:D.find(x=>x._id===s.EventId))==null?void 0:E.title)||"Event"}),s.postedBy._id==(d==null?void 0:d._id)?e.jsx(Pe,{onEdit:()=>es(s._id,s.topic),onDelete:()=>ts(s._id)}):null]})]}),Re===s._id?e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(T,{value:j,onChange:x=>b(x.target.value),className:"resize-none border-green-200 focus:ring-green-500 focus:border-green-500"}),e.jsx(o,{onClick:()=>ss(s._id),className:"bg-green-600 hover:bg-green-700 text-white",children:"Save"}),e.jsx(o,{onClick:()=>U(null),variant:"outline",className:"text-green-700 border-green-200 hover:bg-green-50",children:"Cancel"})]}):e.jsx("p",{className:"mt-3 text-green-900 whitespace-pre-wrap",children:s.topic}),e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsxs(o,{variant:"ghost",size:"sm",className:`flex items-center gap-2 transition-all ${(_=z[s._id])!=null&&_.hasLiked?"bg-green-100 text-green-700 hover:bg-green-200":"text-gray-600 hover:bg-green-50"} ${V.isLoading?"opacity-50 cursor-not-allowed":""}`,onClick:()=>os(s._id),disabled:V.isLoading,children:[e.jsx(Es,{className:`w-4 h-4 transition-colors ${(S=z[s._id])!=null&&S.hasLiked?"fill-green-600 text-green-600":"text-gray-400"}`}),e.jsx("span",{className:`${(L=z[s._id])!=null&&L.hasLiked?"text-green-700":"text-gray-600"}`,children:(($=z[s._id])==null?void 0:$.likesCount)||0})]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"text-green-700 hover:bg-green-50 flex items-center gap-2",onClick:()=>ds(s._id),children:[e.jsx(Me,{className:"w-4 h-4"}),Object.keys(s.comments||{}).length,le[s._id]?e.jsx(Is,{className:"w-4 h-4"}):e.jsx($s,{className:"w-4 h-4"})]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"text-green-700 hover:bg-green-50",children:[e.jsx(Ss,{className:"w-4 h-4 mr-1"}),"Share"]})]}),le[s._id]&&e.jsxs(N.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 space-y-3 pt-4 border-t border-green-100",children:[me(s._id,s.comments),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsx(T,{placeholder:"Add a comment...",className:"resize-none border-green-200 focus:ring-green-500 focus:border-green-500 text-sm",value:R[s._id]||"",onChange:x=>re(A=>({...A,[s._id]:x.target.value}))}),e.jsx(o,{onClick:()=>as(s._id),disabled:oe.isLoading||!((F=R[s._id])!=null&&F.trim()),className:"bg-green-600 hover:bg-green-700 text-white",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]})]})})})},s._id)}):e.jsx(f,{className:"border-green-200 bg-green-50",children:e.jsx(y,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-12 h-12 text-green-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-green-800 mb-2",children:"No discussions yet"}),e.jsx("p",{className:"text-green-600",children:"Be the first to start a discussion in this community!"})]})})})})]})]})]})})};export{Os as default};
